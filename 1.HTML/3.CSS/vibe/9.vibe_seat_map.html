<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>Vibe Seating Chart</title>

    <style>
        :root {
            --bg: #f4f6fb;
            --card: #ffffff;
            --accent: #4a90e2;
            --accent-light: #e5f1ff;
            --group-bg: #fff7dd;
            --text-main: #222222;
            --text-sub: #666666;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                system-ui, sans-serif;
            background: radial-gradient(circle at top, #e9f0ff 0, #f4f6fb 45%, #eef2f8 100%);
            display: flex;
            justify-content: center;
            padding: 40px 16px;
            color: var(--text-main);
        }

        .app {
            width: 100%;
            max-width: 900px;
            background: var(--card);
            border-radius: 24px;
            box-shadow: 0 18px 40px rgba(15, 35, 95, 0.12);
            padding: 28px 26px 32px;
        }

        .app-header { text-align: center; margin-bottom: 24px; }

        .app-title {
            font-size: 28px;
            font-weight: 800;
            margin: 0 0 6px;
        }

        .app-subtitle {
            font-size: 13px;
            color: var(--text-sub);
        }

        /* 주간 선택 */
        .week-selector {
            margin: 20px auto 24px;
            max-width: 360px;
        }

        .week-label {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--text-sub);
        }

        .week-select-wrapper { position: relative; }

        select {
            width: 100%;
            padding: 10px 40px 10px 14px;
            font-size: 14px;
            border-radius: 12px;
            border: 1px solid #d3d8e6;
            background: #f9fbff;
            outline: none;
            appearance: none;
            box-shadow: 0 4px 10px rgba(34, 71, 140, 0.08);
        }

        select:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(74,144,226,.2);
        }

        .week-select-wrapper::after {
            content: "▾";
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 11px;
            color: var(--text-sub);
            pointer-events: none;
        }

        .teacher {
            display: flex;
            justify-content: center;
            margin-bottom: 24px;
        }

        .teacher-card {
            padding: 10px 34px;
            border-radius: 999px;
            border: 1px solid #d1d5e5;
            background: linear-gradient(135deg,#fdfdfd,#f3f6ff);
            font-weight: 600;
            font-size: 14px;
            box-shadow: 0 6px 16px rgba(44, 62, 120, 0.12);
        }

        .classroom {
            display: flex;
            gap: 60px;
            justify-content: center;
            align-items: center;
            margin: 0 auto;
            padding: 18px 10px 10px;
        }

        .groups { display: flex; flex-direction: column; gap: 20px; }

        .group-box {
            border-radius: 18px;
            padding: 14px;
            background: var(--group-bg);
            border: 1px solid #e3d8aa;
            box-shadow: 0 10px 20px rgba(154,119,35,0.15);
            min-width: 230px;
        }

        .group-title {
            font-size: 12px;
            font-weight: 700;
            color: var(--text-sub);
            margin-bottom: 8px;
            letter-spacing: 0.05em;
        }

        .group-row { display: flex; gap: 10px; margin-bottom: 8px; }

        .group-seat { flex: 1; }

        .right-column {
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: stretch;
            min-width: 120px;
        }

        .column-title {
            font-size: 12px;
            font-weight: 700;
            color: var(--text-sub);
            margin-bottom: 4px;
            text-align: center;
        }

        .seat, .group-seat {
            height: 48px;
            border-radius: 12px;
            border: 1px solid #c7d1ea;
            background: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 14px;
            box-shadow: 0 4px 10px rgba(23, 43, 77, 0.08);
            user-select: none;
        }

        .seat:hover, .group-seat:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 18px rgba(23, 43, 77, 0.16);
        }

        /* 편집모드일 때 좌석 스타일 */
        .editing-seat {
            border: 2px dashed #ff7675 !important;
            background: #ffecec !important;
            cursor: move;
        }

        /* 버튼 그룹 */
        .btn-group {
            margin-top: 26px;
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 18px;
            font-size: 13px;
            font-weight: 600;
            border-radius: 999px;
            border: none;
            cursor: pointer;
            color: #fff;
            letter-spacing: 0.03em;
        }

        .edit-btn { background: #fdcb6e; color: #3b2700; }
        .random-btn { background: #4a90e2; }
        .save-btn { background: #6c5ce7; }
        .pdf-btn { background: #00b894; }

        .btn:hover { filter: brightness(1.05); }
    </style>
</head>

<body>
<div class="app">
    <div class="app-header">
        <h1 class="app-title">새싹 웹개발 반 자동 자리배치표</h1>
        <div class="app-subtitle">주간별 저장 + 랜덤 미리보기 + 편집모드 + PDF 다운로드</div>
    </div>

    <div class="week-selector">
        <div class="week-label">주간 선택</div>
        <div class="week-select-wrapper">
            <select id="weekSelect" onchange="loadWeek()"></select>
        </div>
    </div>

    <div class="teacher">
        <div class="teacher-card">강사님 + 화면</div>
    </div>

    <div class="classroom">
        <div class="groups">
            <div class="group-box">
                <div class="group-title">앞 모둠</div>
                <div class="group-row">
                    <div class="group-seat" id="A"></div>
                    <div class="group-seat" id="B"></div>
                </div>
                <div class="group-row">
                    <div class="group-seat" id="C"></div>
                    <div class="group-seat" id="D"></div>
                </div>
            </div>

            <div class="group-box">
                <div class="group-title">뒤 모둠</div>
                <div class="group-row">
                    <div class="group-seat" id="E"></div>
                    <div class="group-seat" id="F"></div>
                </div>
                <div class="group-row">
                    <div class="group-seat" id="G"></div>
                    <div class="group-seat" id="H"></div>
                </div>
            </div>
        </div>

        <div class="right-column">
            <div class="column-title">오른쪽 줄</div>
            <div class="seat" id="R1"></div>
            <div class="seat" id="R2"></div>
            <div class="seat" id="R3"></div>
            <div class="seat" id="R4"></div>
            <div class="seat" id="R5"></div>
        </div>
    </div>

    <div class="btn-group">
        <button class="btn edit-btn" id="editBtn" onclick="toggleEditMode()">편집모드 시작</button>
        <button class="btn random-btn" onclick="showRandom()">랜덤 배치 보기</button>
        <button class="btn save-btn" onclick="manualSave()">현재 자리 저장하기</button>
        <button class="btn pdf-btn" onclick="downloadPDF()">PDF 다운로드</button>
    </div>
</div>

<!-- PDF 라이브러리 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
    const students = [
        "신지원","남기정","변영찬","김윤군","이지안",
        "김준성","김주연","공정배","이유랑",
        "노정운","장수빈","박호정","조진희"
    ];
    const seatOrder = ["A","B","C","D","E","F","G","H","R1","R2","R3","R4","R5"];

    let editMode = false; // 편집모드 여부

    function f(date) {
        const y = date.getFullYear();
        const m = String(date.getMonth()+1).padStart(2,"0");
        const d = String(date.getDate()).padStart(2,"0");
        return `${y}-${m}-${d}`;
    }

    function generateWeeks() {
        let start = new Date("2025-11-17");
        const end = new Date("2026-02-28");
        const weeks = [];
        while (start <= end) {
            const monday = new Date(start);
            const sunday = new Date(start);
            sunday.setDate(sunday.getDate() + 6);
            weeks.push({
                key: f(monday),
                label: `${f(monday)} ~ ${f(sunday)}`
            });
            start.setDate(start.getDate() + 7);
        }
        return weeks;
    }

    const weekSelect = document.getElementById("weekSelect");
    const allWeeks = generateWeeks();

    allWeeks.forEach(w => {
        const opt = document.createElement("option");
        opt.value = w.key;
        opt.textContent = w.label;
        weekSelect.appendChild(opt);
    });

    function generateRandomSeats() {
        return [...students].sort(() => Math.random() - 0.5);
    }

    function saveWeek(week, seats) {
        let db = JSON.parse(localStorage.getItem("weeklySeats") || "{}");
        db[week] = seats;
        localStorage.setItem("weeklySeats", JSON.stringify(db));
    }

    function fillSeats(list) {
        seatOrder.forEach((id, i) => {
            document.getElementById(id).innerText = list[i] || "";
        });
    }

    function loadWeek() {
        const week = weekSelect.value;
        // 랜덤 상태 초기화 느낌으로, 단순히 저장된 값만 표시함
        let db = JSON.parse(localStorage.getItem("weeklySeats") || "{}");
        if (!db[week]) {
            fillSeats(Array(13).fill("")); // 저장 안 된 주는 빈 칸
            return;
        }
        fillSeats(db[week]);
    }

    function getCurrentSeats() {
        return seatOrder.map(id => document.getElementById(id).innerText);
    }

    function manualSave() {
        const week = weekSelect.value;
        const seats = getCurrentSeats();

        if (!seats.some(s => s.trim() !== "")) {
            alert("현재 자리가 비어 있어 저장할 수 없음!");
            return;
        }

        saveWeek(week, seats);
        alert(`${week} 주의 자리배치가 저장됨!`);
    }

    function showRandom() {
        const randomSeats = generateRandomSeats();
        fillSeats(randomSeats);
    }

    async function downloadPDF() {
        const { jsPDF } = window.jspdf;
        const element = document.querySelector(".classroom");

        const canvas = await html2canvas(element, { scale: 2 });
        const imgData = canvas.toDataURL("image/png");
        const pdf = new jsPDF({ orientation: "portrait", unit: "px", format: "a4" });

        const pageWidth = pdf.internal.pageSize.getWidth();
        const imgWidth = pageWidth - 40;
        const imgHeight = canvas.height * (imgWidth / canvas.width);

        pdf.addImage(imgData, "PNG", 20, 20, imgWidth, imgHeight);
        pdf.save(`자리배치표_${weekSelect.value}.pdf`);
    }

    // 편집모드 토글
    function toggleEditMode() {
        editMode = !editMode;
        const btn = document.getElementById("editBtn");
        btn.textContent = editMode ? "편집모드 종료" : "편집모드 시작";

        seatOrder.forEach(id => {
            const el = document.getElementById(id);
            el.setAttribute("draggable", editMode);
            if (editMode) {
                el.classList.add("editing-seat");
            } else {
                el.classList.remove("editing-seat");
            }
        });
    }

    // 드래그 이벤트 초기 설정
    function initDragEvents() {
        seatOrder.forEach(id => {
            const el = document.getElementById(id);

            el.addEventListener("dragstart", (e) => {
                if (!editMode) {
                    e.preventDefault();
                    return;
                }
                e.dataTransfer.setData("text/plain", id);
            });

            el.addEventListener("dragover", (e) => {
                if (!editMode) return;
                e.preventDefault();
            });

            el.addEventListener("drop", (e) => {
                if (!editMode) return;
                e.preventDefault();
                const fromId = e.dataTransfer.getData("text/plain");
                const toId = id;
                if (!fromId || fromId === toId) return;

                const fromEl = document.getElementById(fromId);
                const toEl = document.getElementById(toId);

                const temp = fromEl.innerText;
                fromEl.innerText = toEl.innerText;
                toEl.innerText = temp;
            });
        });
    }

    // 초기 로딩
    weekSelect.value = allWeeks[0].key;
    loadWeek();
    initDragEvents();
</script>

</body>
</html>
